<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ìƒê°ì˜ ë°”ë‹¤ - ì·¨í–¥ ì£¼ì œ ë½‘ê¸° (Lite)</title>
  <style>
    :root{
      --bg:#f7f8fa; --card:#ffffff; --text:#1f2937; --muted:#6b7280;
      --primary:#2563eb; --primary-hover:#1e40af; --danger:#ef4444;
    }
    *{box-sizing:border-box}
    body{margin:0; padding:18px; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; background:var(--bg); color:var(--text)}
    h1{margin:0 0 8px; font-size:1.6rem}
    .sub{color:var(--muted); margin-bottom:14px}
    .wrap{max-width:900px; margin:0 auto}

    .toolbar,.card,.footer{
      background:var(--card); border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,.06); padding:12px;
    }
    .toolbar{
      position:sticky; top:8px; z-index:5;
      display:flex; flex-wrap:wrap; gap:8px; align-items:center;
    }
    select,button{
      padding:10px 12px; border:1px solid #e5e7eb; border-radius:10px; background:#fff; color:var(--text); font-size:.95rem;
    }
    button{background:var(--primary); color:#fff; border:none; cursor:pointer}
    button:hover{background:var(--primary-hover)}
    button.danger{background:var(--danger)}
    .count{margin-left:auto; color:var(--muted); font-size:.95rem}

    .card{margin-top:12px}
    .question-box{
      min-height:96px; display:flex; align-items:center; justify-content:center;
      text-align:center; border:2px dashed #e5e7eb; border-radius:12px;
      padding:16px; line-height:1.5; font-size:clamp(1rem,4.8vw,1.3rem);
    }
    .meta{display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; color:#111827}
    .badge{background:#eef2ff; color:#1e3a8a; padding:4px 8px; border-radius:999px; font-weight:600; font-size:.9rem}
    .status{margin-top:6px; color:var(--muted); min-height:20px; font-size:.95rem}

    .footer{margin-top:10px; display:flex; flex-wrap:wrap; gap:8px; align-items:center}
    .spacer{flex:1}

    .list-card{margin-top:12px}
    .list h4{margin:12px 0 6px}
    .list ul{margin:0; padding-left:18px}
    .list li{margin:4px 0; color:#374151}

    /* Mobile polish */
    @media (max-width:520px){
      body{padding:14px}
      h1{font-size:1.35rem}
      .toolbar select, .toolbar button{width:100%}
      .count{width:100%; text-align:right}
      button, select{font-size:16px} /* iOS í™•ëŒ€ ë°©ì§€ */
    }
  </style>
</head>
<body>
<div class="wrap">
  <h1>ğŸ™ï¸ ë‚´ ì·¨í–¥ì„ ì†Œê°œí•©ë‹ˆë‹¤ â€” ì£¼ì œ ë½‘ê¸°</h1>
  <div class="sub">ì§ˆë¬¸ íŒ¨ìŠ¤í•´ë„ ëœë‹¤ê³  ê¼­ ì•ˆë‚´í•´ì£¼ì„¸ìš”.</div>

  <!-- Controls -->
  <div class="toolbar" role="region" aria-label="controls">
    <label for="category" class="sr-only">ì¹´í…Œê³ ë¦¬</label>
    <select id="category">
      <option value="ALL">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
    </select>
    <button id="btnPick">ğŸ² ì£¼ì œ ë½‘ê¸°</button>
    <button id="btnToggleList" type="button">ì „ì²´ ëª©ë¡ í† ê¸€</button>
    <div class="count" id="count">0 / 0</div>
  </div>

  <!-- Current -->
  <section class="card" aria-live="polite">
    <div class="question-box" id="questionBox">ë²„íŠ¼ì„ ëˆŒëŸ¬ ì·¨í–¥ ì£¼ì œë¥¼ ë½‘ì•„ë³´ì„¸ìš”!</div>
    <div class="meta">
      <span class="badge" id="currentCategory">ì¹´í…Œê³ ë¦¬: -</span>
      <span class="badge" id="subcount">ì§„í–‰: 0 / 0</span>
    </div>
    <div class="status" id="status"></div>
    <div class="footer">
      <button id="btnResetCat" type="button">í˜„ì¬ ì¹´í…Œê³ ë¦¬ ì´ˆê¸°í™”</button>
      <div class="spacer"></div>
      <button id="btnResetAll" class="danger" type="button">ì „ì²´ ì´ˆê¸°í™”</button>
    </div>
  </section>

  <!-- All list -->
  <section class="card list-card" id="allList" style="display:none">
    <h3>ğŸ“‹ ëª¨ë“  ì£¼ì œ (ì¹´í…Œê³ ë¦¬ë³„)</h3>
    <div class="list" id="listContainer"></div>
  </section>
</div>

<!-- accessibility helper -->
<style>.sr-only{position:absolute;width:1px;height:1px;margin:-1px;padding:0;overflow:hidden;clip:rect(0 0 0 0);border:0}</style>

<script>
/* =========================
   ë°ì´í„° ì •ì˜ (ê²Œì„Â·ì•±/íˆ´ ì œì™¸)
========================= */
const TOPICS = {
  "ìŒì‹": [
    "ë‚´ ì¸ìƒ ë©”ë‰´ 1ê°€ì§€ + ì¶”ì²œ ì‹ë‹¹",
    "ë‹¤ì´ì–´íŠ¸ ë•Œ ë²„í‹°ëŠ” ë©”ë‰´",
    "ë¹„ ì˜¤ëŠ” ë‚  ìµœì•  ìŒì‹",
  ],
  "ì¹´í˜/ë””ì €íŠ¸": [
    "ë‚´ ì·¨í–¥ ì¹´í˜ ì¸í…Œë¦¬ì–´/ë¶„ìœ„ê¸°",
    "ì¹´ê³µí•˜ê¸° ì¢‹ì€ ì¹´í˜ ì¶”ì²œ",
    "ì¢‹ì•„í•˜ëŠ” ë¼ë–¼/ìŒë£Œ",
    "ë‚˜ë§Œ ì•„ëŠ” ë™ë„¤ ì¹´í˜",
  ],
  "ìŒì•…": [
    "ìš”ì¦˜ ë“£ëŠ” ë…¸ë˜ 1ê³¡ + í•œì¤„ ì¶”ì²œ",
    "ìš´ë™/ì§‘ì¤‘/ì‚°ì±… í”Œë ˆì´ë¦¬ìŠ¤íŠ¸",
    "ì•„ì¹¨ì— ë“£ê¸° ì¢‹ì€ ë…¸ë˜",
    "ë°¤ì— ë“£ê¸° ì¢‹ì€ ë…¸ë˜",
  ],
  "ì˜í™”/ë“œë¼ë§ˆ": [
    "ì¸ìƒ ì˜í™” 1í¸ + ì´ìœ ",
    "ìµœê·¼ ëª°ì•„ë³¸ ë“œë¼ë§ˆ ì¶”ì²œ",
    "OSTê°€ ë¯¸ì¹œ ì‘í’ˆ",
    "ë°˜ì „ì´ ì¢‹ì€ ì‘í’ˆ",
    "íë§ì´ í•„ìš”í•  ë•Œ ë³´ëŠ” ì‘í’ˆ",
  ],
 
  "ì—¬í–‰": [
    "ë‚´ê°€ ì‚¬ë‘í•œ ë„ì‹œ + ì´ìœ ",
    "íë§ì´ í•„ìš”í•  ë•Œ ê°€ëŠ” ì¥ì†Œ",
    "ë¹„ ì˜¤ëŠ” ë‚  ì¢‹ì€ ì—¬í–‰ ì½”ìŠ¤",
    "í˜¼ì ê°€ë„ ì¢‹ì€ ì—¬í–‰ì§€",
    "ê°€ë³´ê³  ì‹¶ì€ ì—¬í–‰ì§€",
  ],
  
  "ì¸ìƒ ê²½í—˜": [
    "ë‚´ ì¸ìƒì—ì„œ ê°€ì¥ ì¸ìƒ ê¹Šì€ ìˆœê°„",
    "ë‚˜ë§Œì˜ ì „í™˜ì ì´ ëœ ê²½í—˜",
    "ê¼­ ë‹¤ì‹œ í•´ë³´ê³  ì‹¶ì€ ê²½í—˜",
    "ìš”ì¦˜ ìì£¼ ë“œëŠ” ìƒê°",
    "ìš”ì¦˜ ë‚˜ë¥¼ ì›ƒê²Œ í•œ ì†Œì†Œí•œ ìˆœê°„",
    "ì§€ì¹œ ë‚  íšŒë³µí•˜ëŠ” ë‚˜ë§Œì˜ ë°©ë²•",
    "ë‚´ê°€ ì œì¼ ì¢‹ì•„í•˜ëŠ” í•˜ë£¨ì˜ ì‹œê°„ëŒ€",
    ],
};

/* =========================
   ìƒíƒœ & ìš”ì†Œ
========================= */
const STORAGE_KEY = "seangbal_taste_lite_v1";
let used = new Set(); // "ì¹´í…Œê³ ë¦¬|ë¬¸ì¥" í‚¤
let current = null;

const elCategory = document.querySelector("#category");
const elQuestion = document.querySelector("#questionBox");
const elCount = document.querySelector("#count");
const elSubCount = document.querySelector("#subcount");
const elCurrentCat = document.querySelector("#currentCategory");
const elStatus = document.querySelector("#status");
const elAllList = document.querySelector("#allList");
const elListContainer = document.querySelector("#listContainer");

const btnPick = document.querySelector("#btnPick");
const btnToggleList = document.querySelector("#btnToggleList");
const btnResetCat = document.querySelector("#btnResetCat");
const btnResetAll = document.querySelector("#btnResetAll");

/* =========================
   ì´ˆê¸°í™”
========================= */
init();

function init(){
  // ì¹´í…Œê³ ë¦¬ ì˜µì…˜
  for(const cat of Object.keys(TOPICS)){
    const opt = document.createElement("option");
    opt.value = cat; opt.textContent = cat;
    elCategory.appendChild(opt);
  }
  // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ë³µì›
  const saved = loadState();
  if(saved){ used = new Set(saved.used || []); }

  updateCounts();
  renderAllList();
  setStatus("ì¤€ë¹„ ì™„ë£Œ. ì·¨í–¥ ì£¼ì œë¥¼ ë½‘ì•„ë³´ì„¸ìš”!");
  selfValidateData();
}

/* =========================
   ìŠ¤í† ë¦¬ì§€
========================= */
function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify({ used:[...used] })); }
function loadState(){
  try{ const raw = localStorage.getItem(STORAGE_KEY); return raw ? JSON.parse(raw) : null; }
  catch(e){ return null; }
}

/* =========================
   ìœ í‹¸/ë Œë”
========================= */
function keyOf(cat, text){ return `${cat}|${text}`; }
function totalCount(){ return Object.values(TOPICS).reduce((a,arr)=>a+arr.length,0); }
function usedCount(){ return used.size; }
function subCount(cat){
  if(cat==="ALL") return { used: usedCount(), total: totalCount() };
  const total = TOPICS[cat].length;
  const usedInCat = [...used].filter(k => k.startsWith(cat+"|")).length;
  return { used: usedInCat, total };
}
function updateCounts(){
  elCount.textContent = `${usedCount()} / ${totalCount()}`;
  const cat = elCategory.value || "ALL";
  const sc = subCount(cat);
  elSubCount.textContent = `ì§„í–‰: ${sc.used} / ${sc.total}`;
}
function updateCurrentUI(item){
  if(!item){
    elQuestion.textContent = "ë²„íŠ¼ì„ ëˆŒëŸ¬ ì·¨í–¥ ì£¼ì œë¥¼ ë½‘ì•„ë³´ì„¸ìš”!";
    elCurrentCat.textContent = "ì¹´í…Œê³ ë¦¬: -";
    return;
  }
  elQuestion.textContent = item.text;
  elCurrentCat.textContent = `ì¹´í…Œê³ ë¦¬: ${item.cat}`;
}
function setStatus(msg){ elStatus.textContent = msg || ""; }

function renderAllList(){
  elListContainer.innerHTML = "";
  for(const [cat, arr] of Object.entries(TOPICS)){
    const h = document.createElement("h4"); h.textContent = cat;
    const ul = document.createElement("ul");
    for(const text of arr){
      const li = document.createElement("li");
      const usedMark = used.has(keyOf(cat,text)) ? " (ì‚¬ìš©ë¨)" : "";
      li.textContent = `${text}${usedMark}`;
      ul.appendChild(li);
    }
    elListContainer.appendChild(h);
    elListContainer.appendChild(ul);
  }
}

/* =========================
   ì¶”ì²¨
========================= */
function availablePool(cat){
  const pool = [];
  const cats = (cat==="ALL") ? Object.keys(TOPICS) : [cat];
  for(const c of cats){
    for(const text of TOPICS[c]){
      if(!used.has(keyOf(c,text))) pool.push({cat:c, text});
    }
  }
  return pool;
}
function pickRandom(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

function pickTopic(){
  const cat = elCategory.value;
  let pool = availablePool(cat);

  if(pool.length === 0){
    if(cat !== "ALL"){
      // ì„ íƒ ì¹´í…Œê³ ë¦¬ ì†Œì§„ ì‹œ ì „ì²´ì—ì„œ í´ë°±
      pool = availablePool("ALL");
      if(pool.length === 0){
        setStatus("ëª¨ë“  ì£¼ì œë¥¼ ì†Œì§„í–ˆìŠµë‹ˆë‹¤. ì´ˆê¸°í™”ê°€ í•„ìš”í•´ìš”.");
        return;
      } else {
        setStatus("ì„ íƒí•œ ì¹´í…Œê³ ë¦¬ ì†Œì§„ â†’ ì „ì²´ì—ì„œ ì¶”ì²¨í•©ë‹ˆë‹¤.");
      }
    } else {
      setStatus("ëª¨ë“  ì£¼ì œë¥¼ ì†Œì§„í–ˆìŠµë‹ˆë‹¤. ì´ˆê¸°í™”ê°€ í•„ìš”í•´ìš”.");
      return;
    }
  }

  const item = pickRandom(pool);
  current = item;
  used.add(keyOf(item.cat, item.text));
  saveState();

  updateCounts();
  updateCurrentUI(item);
  renderAllList();
  setStatus("ì¶”ì²¨ ì™„ë£Œ!");
}

/* =========================
   ì´ˆê¸°í™” & í† ê¸€
========================= */
function resetCategory(){
  const cat = elCategory.value;
  if(cat === "ALL"){ setStatus("ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•œ ë’¤ ì‹¤í–‰í•˜ì„¸ìš”."); return; }
  let cnt = 0;
  for(const k of [...used]){
    if(k.startsWith(cat+"|")){ used.delete(k); cnt++; }
  }
  saveState(); updateCounts(); renderAllList(); setStatus(`${cat} ì´ˆê¸°í™”: ${cnt}ê°œ í•´ì œ`);
}
function resetAll(){
  used = new Set(); current = null;
  saveState(); updateCounts(); renderAllList(); updateCurrentUI(null);
  setStatus("ì „ì²´ ì´ˆê¸°í™” ì™„ë£Œ");
}
function toggleList(){
  const show = elAllList.style.display === "none";
  elAllList.style.display = show ? "block" : "none";
  document.querySelector("#btnToggleList").textContent = show ? "ì „ì²´ ëª©ë¡ ìˆ¨ê¸°ê¸°" : "ì „ì²´ ëª©ë¡ í† ê¸€";
}

/* =========================
   ë°ì´í„° ìê°€ ê²€ì¦
========================= */
function selfValidateData(){
  const seen = new Set(); let dup = [];
  for(const [cat, arr] of Object.entries(TOPICS)){
    for(const text of arr){
      const k = keyOf(cat,text);
      if(seen.has(k)) dup.push(k);
      seen.add(k);
    }
  }
  const invalidUsed = [...used].filter(k => !seen.has(k));
  if(invalidUsed.length){ for(const k of invalidUsed) used.delete(k); saveState(); }
  console.log("[ê²€ì¦] ì´ í•­ëª©:", seen.size, "| ì¤‘ë³µ:", dup.length, "| ìœ íš¨í•˜ì§€ ì•Šì€ used ì œê±°:", invalidUsed.length);
}

/* =========================
   ì´ë²¤íŠ¸
========================= */
btnPick.addEventListener("click", pickTopic);
btnToggleList.addEventListener("click", toggleList);
btnResetCat.addEventListener("click", resetCategory);
btnResetAll.addEventListener("click", resetAll);
elCategory.addEventListener("change", ()=>{ updateCounts(); setStatus("ì¹´í…Œê³ ë¦¬ ë³€ê²½ë¨."); });

// Enterë¡œ ë¹ ë¥¸ ë½‘ê¸°
document.addEventListener("keydown", e=>{ if(e.key==="Enter") pickTopic(); });
</script>
</body>
</html>
